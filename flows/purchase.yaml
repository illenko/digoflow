id: purchase
name: Purchase Flow

entrypoint:
    type: http-handler
    config:
      method: POST
      path: /purchase

input:
  headers:
    - name: x-api-key
      type: string
  body: 
    type: json
    fields:
      - name: id
        type: string
      - name: description
        type: string
      - name: amount
        type: float
      - name: card
        type: string
      - name: payer.id
        type: string
      - name: payer.name.first
        type: string
      - name: payer.name.last
        type: string
      - name: paymentSystem.url
        type: string
      - name: paymentSystem.apiKey
        type: string

tasks:
  - id: log-some-data
    type: digoflow.log
    input:
      - name: message-to-print
        type: string
        value: "This is a description from input: {{ input.body.description }}"
      - name: message-to-print2
        type: string
        value: This is a hardcoded description

  - id: use-custom-log
    name: custom-log
    type: custom-log
    input:
      - name: message-to-print
        type: string
        value: "{{ input.body.payer.name.first }}"

  - id: call-to-payment-system
    type: digoflow.httpRequest
    input:
      - name: uri
        type: string
        value: "{{ input.body.paymentSystem.url }}/Payment"
      - name: method
        type: string
        value: POST
      - name: header.x-api-key
        type: string
        value: "Authorization: {{ input.body.paymentSystem.apiKey }}"
      - name: body.card
        type: string
        value: "{{ input.body.card }}"
      - name: body.payer
        type: string
        value: "{{ input.body.payer.name.first }} {{ input.body.payer.name.last }}"
      - name: body.amount
        type: float
        value: "{{ input.body.amount }}"